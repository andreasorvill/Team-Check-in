<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SANA – Word Cloud Dashboard</title>

  <link rel="stylesheet" href="styles.css">

  <!-- WordCloud2.js -->
  <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.3/src/wordcloud2.min.js"></script>
</head>

<body class="dashboard-body">

  <div class="dashboard-container">

    <img src="images/SANA_simple.png" class="dashboard-logo" alt="SANA Logo">

    <h1 class="dashboard-title">Weekly Word Cloud</h1>
    <p class="dashboard-subtitle">The most frequently selected words appear largest.</p>

    <div id="cloud" class="cloud-box"></div>

    <button class="back-btn" onclick="window.location.href='index.html'">
      ← Back to Check-In
    </button>

  </div>

  <script>
const RAW_API =
  "https://script.google.com/macros/s/AKfycbwWDyuw9r1IQCWZzGBC2up3pN53X3BpjQRnCDRbZpXsmQ70UYTTjUQQUUXeR80YkqFXTg/exec";

const DATA_URL =
  "https://sana-cors-proxy.andreas-orvill.workers.dev/?url=" +
  encodeURIComponent(RAW_API);


    async function loadData() {
      try {
        const response = await fetch(DATA_URL);

        // API RETURNS PURE JSON → parse normally
        const entries = await response.json();

        const frequency = {};

        // Count each word
        entries.forEach(entry => {
          entry.words.forEach(word => {
            if (!word) return;
            const clean = word.trim();
            frequency[clean] = (frequency[clean] || 0) + 1;
          });
        });

        // Convert to list for wordcloud2
        const wordList = Object.keys(frequency).map(w => [
          w,
          frequency[w] * 10
        ]);

        WordCloud(document.getElementById("cloud"), {
          list: wordList,
          gridSize: 12,
          weightFactor: 5,
          color: () => "hsl(" + Math.random() * 360 + ", 80%, 60%)",
          rotateRatio: 0.1,
          backgroundColor: "transparent"
        });

      } catch (err) {
        console.error("Error loading cloud:", err);
      }
    }

    loadData();
  </script>

</body>
</html>
